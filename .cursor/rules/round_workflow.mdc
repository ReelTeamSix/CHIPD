---
description: CHIP'D Round Workflow - NFC + Dynamic Games + Attestation
globs:
alwaysApply: false
---

# CHIP'D Round Workflow

## The Core Differentiators

1. **Physical NFC Chip** - Status symbol, conversation starter, cross-platform solution
2. **Dynamic Side Games** - Context-aware prompts during play, not pre-configured
3. **Verified Handicap** - Calculated from attested rounds only, can't be gamed
4. **Peer Attestation** - Mutual score confirmation, prevents cheating

---

## The Chip = The Subscription

The chip IS the premium product. No chip = free tier. Has chip = verified tier.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUBSCRIPTION TIERS                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  FREE ($0)              VERIFIED ($X/mo)      THE 900 ($$$$)   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  â—‹ No chip              ğŸŸ¢ Standard chip      ğŸ¥‡ Gold chip      â”‚
â”‚  â—‹ Unverified           âœ“ Full verification   âœ“ Full verify    â”‚
â”‚  â—‹ 3 rounds/month       âœ“ Unlimited rounds    âœ“ Unlimited      â”‚
â”‚  â—‹ No side games        âœ“ All side games      âœ“ All games      â”‚
â”‚  â—‹ No chip betting      âœ“ Chip economy        âœ“ Chip economy   â”‚
â”‚  â—‹ No handicap          âœ“ Verified handicap   âœ“ Verified HC    â”‚
â”‚  â—‹ Basic leaderboard    âœ“ Full leaderboard    âœ“ Gold badge     â”‚
â”‚                                               âœ“ Lifetime       â”‚
â”‚                                               âœ“ Early access   â”‚
â”‚                                               âœ“ Founder #1-900 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### The Conversion Funnel

```
Free user joins friend's round via link
         â”‚
         â–¼
Sees "Unverified" badge, can't bet, limited features
         â”‚
         â–¼
"Get a CHIP'D chip to unlock full features"
         â”‚
         â–¼
Subscribes â†’ Chip shipped â†’ Full access
```

### Chip Types

| Chip | Tier | Description |
|------|------|-------------|
| ğŸŸ¢ Standard (Green) | Verified | Monthly subscription, full features |
| ğŸ¥‡ Gold | The 900 | Founder tier, lifetime, limited to 900 |
| ğŸ† Custom | Verified+ | Club/tournament branded (future) |

### What Free Users CAN Do
- âœ… Join rounds via invite link (unverified)
- âœ… Enter scores
- âœ… Attest others' scores
- âœ… See distances (basic GPS)
- âœ… 3 rounds per month

### What Free Users CAN'T Do
- âŒ Own a chip (tap to join/verify)
- âŒ Be "verified" in rounds
- âŒ Create or join side games
- âŒ Bet chips
- âŒ Track verified handicap
- âŒ Unlimited rounds

---

## Round Flow

### Phase 1: Start Round

```
Captain creates round in app
â”œâ”€â”€ Selects course (optional, GPS can detect)
â”œâ”€â”€ Taps each player's chip to invite:
â”‚   â”œâ”€â”€ Tap B's chip â†’ B added
â”‚   â”œâ”€â”€ Tap C's chip â†’ C added
â”‚   â””â”€â”€ Tap D's chip â†’ D added
â”œâ”€â”€ GPS verifies all at course
â””â”€â”€ Round begins: status = 'in_progress'
```

**Taps required:** N-1 (where N = players)
- Twosome: 1 tap
- Threesome: 2 taps
- Foursome: 3 taps

### Phase 2: During Round

Each player enters scores on their own phone. Scores sync in real-time.

**Dynamic Game Prompts** appear based on context:

| Trigger | Prompt |
|---------|--------|
| Arrive at Par 3 (GPS) | "Closest to Pin? [10 chips] [Custom] [Skip]" |
| Player scores birdie | "Birdie! Start skins game?" |
| Complete hole 9 | "Front 9 done. Nassau bet?" |
| Par 5 approach | "Longest drive?" |

Players can:
- Accept prompts â†’ Game created for that hole/moment
- Skip prompts â†’ No game, just score tracking
- Create custom games anytime

**Side Game Flow:**
```
A proposes CTP on Hole 7 (10 chips)
â”œâ”€â”€ Push to B, C, D: "CTP Hole 7? [I'm in] [Pass]"
â”œâ”€â”€ B, C accept. D passes.
â”œâ”€â”€ After hole: "Who won?" â†’ B selected
â”œâ”€â”€ A and C tap B's chip (or confirm in-app)
â””â”€â”€ B wins pot (20 chips from A and C)
```

### Phase 3: End Round

```
Captain taps "Close Round"
â”œâ”€â”€ Each player taps Captain's chip:
â”‚   â”œâ”€â”€ B taps â†’ B verified + sees A's final score
â”‚   â”œâ”€â”€ C taps â†’ C verified + sees A's final score
â”‚   â””â”€â”€ D taps â†’ D verified + sees A's final score
â”œâ”€â”€ GPS captures end location
â””â”€â”€ status = 'completed'
```

**Taps required:** N-1 (each other player taps Captain)

### Phase 4: Attestation

Each player sees a summary screen:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ROUND COMPLETE                         â”‚
â”‚                                        â”‚
â”‚ SCORES (Confirm All)                   â”‚
â”‚ A: 78  [âœ“]                             â”‚
â”‚ B: 82  [âœ“]                             â”‚
â”‚ C: 85  [Review]  â† Tap to see details  â”‚
â”‚ D: 90  [âœ“]                             â”‚
â”‚                                        â”‚
â”‚ SIDE GAMES                             â”‚
â”‚ CTP Hole 7: B won (20 chips)    [âœ“]    â”‚
â”‚ CTP Hole 12: A won (30 chips)   [âœ“]    â”‚
â”‚ Skins: A 2, C 1, carryover 6    [âœ“]    â”‚
â”‚                                        â”‚
â”‚ [Confirm All]  [Dispute]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**When all confirm:**
- status = 'verified'
- Chip balances update
- Handicaps recalculate

**If anyone disputes:**
- status = 'disputed'
- Disputed items flagged for resolution
- Can fix and re-attest

---

## Handicap System

Handicap is calculated ONLY from verified rounds.

```
Verified Round
     â”‚
     â–¼
Differential = (Score - Course Rating) Ã— (113 / Slope)
     â”‚
     â–¼
Handicap = Average of best 8 of last 20 differentials
     â”‚
     â–¼
Stored in handicap_history table
```

**Why this matters:**
- Can't inflate handicap with fake rounds
- Partners would dispute obviously wrong scores
- Betting is fair because handicaps are real

**Handicap-Based Games:**
```
A (8.2) vs B (15.7) in stroke play
B gets 8 strokes (on hardest 8 holes per course rating)
Fair game despite skill difference
```

---

## Chip Economy

All transactions are immutable ledger entries.

| Transaction Type | Description |
|-----------------|-------------|
| game_win | Won a side game |
| game_loss | Lost a side game |
| round_bonus | Bonus for completing verified round |
| streak_bonus | Consecutive rounds bonus |
| purchase | Bought chips (future) |
| transfer_in/out | Sent/received chips |

**Chip Settlement (automatic):**
```
Round ends, all attest
â”œâ”€â”€ Skins: A +15, B +5, C +10, D -30
â”œâ”€â”€ CTP: A +40, B +0, C +40, D -80
â”œâ”€â”€ Nassau: A +40, B -20, C +60, D -80
â”œâ”€â”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â””â”€â”€ NET: A +95, B -15, C +110, D -190

Transactions created, balances updated
```

---

## NFC Tap Summary

| Moment | Who Taps | What Happens |
|--------|----------|--------------|
| Round Start | Captain taps each player's chip | Players added to round |
| During (optional) | Losers tap winner's chip | Concede side bet in real-time |
| Round End | Each player taps Captain's chip | Presence verified, attestation begins |
| Side Game Confirm | Losers tap winner's chip (or in-app) | Result confirmed |

---

## Unverified Players (No Chip)

Players without chips can still participate - they just won't be NFC-verified.

### How They Join

```
Captain creates round
â”œâ”€â”€ Taps B's chip â†’ B added (verified)
â”œâ”€â”€ Taps C's chip â†’ C added (verified)
â”œâ”€â”€ D doesn't have a chip...
â”‚   â””â”€â”€ Captain taps "Invite Player"
â”‚   â””â”€â”€ Options: [Share Link] [Show QR] [Nearby]
â”‚   â””â”€â”€ D opens link, joins round
â”‚   â””â”€â”€ D added (unverified)
â””â”€â”€ Round starts
```

### Verification Status

| Status | Meaning |
|--------|---------|
| `verified` | Joined via NFC AND closed via NFC |
| `partial` | Either joined OR closed via NFC |
| `unverified` | No NFC interaction (link/QR join) |

### Round Verification Level

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Round with 4 players:                                         â”‚
â”‚                                                                â”‚
â”‚  A âœ“  B âœ“  C â—‹  D âœ“                                            â”‚
â”‚                                                                â”‚
â”‚  verification_level = 'partial' (3/4 verified)                 â”‚
â”‚  verified_player_count = 3                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### What Unverified Players Can Do

| Feature | Verified | Unverified |
|---------|----------|------------|
| Join rounds | Via NFC tap | Via link/QR |
| Enter scores | âœ“ | âœ“ |
| Attest others | âœ“ | âœ“ |
| Be attested | âœ“ (NFC proven) | âœ“ (trust-based) |
| Join side games | âœ“ | âœ“ (with warning) |
| Handicap counts | âœ“ Full weight | Reduced/None |
| Leaderboard badge | "Verified" | "Unverified" |

### Side Games with Unverified Players

```
A proposes CTP (10 chips each)
â”œâ”€â”€ B (verified) â†’ [I'm in]
â”œâ”€â”€ C (unverified) â†’ Warning: "C is unverified"
â”‚   â””â”€â”€ [Include Anyway] [Verified Only]
â””â”€â”€ Stakes adjusted if needed
```

### Incentive to Get a Chip

- Unverified rounds don't count toward "Verified Handicap"
- Unverified players show a badge on leaderboards
- Can't close rounds for others (no chip to tap)
- Creates natural upgrade path: "Get verified to prove your scores"

---

## Failure Modes

| Scenario | Resolution |
|----------|------------|
| Captain's phone dies | Another player can take over as captain (transfer) |
| Player leaves early | They can't tap out, marked "incomplete" |
| Player disputes score | Round is flagged, specific hole can be reviewed |
| NFC tag lost | User registers new tag, old one revoked |
| No internet during round | Offline mode, syncs when connected |
| Player has no chip | Join via link, marked "unverified" |

---

## Database Tables

### Core
- `users` - Profile, handicap, chip_balance
- `courses` - Course info with hole GPS data
- `nfc_tags` - Player-owned tags
- `rounds` - Round metadata, GPS, status
- `round_players` - Players in round, scores, attestation

### Games
- `round_games` - Dynamic games created during round
- `round_game_players` - Who's in each game, handicap strokes
- `round_game_results` - Outcomes, confirmation tracking

### Economy
- `chip_transactions` - Immutable ledger
- `handicap_history` - Handicap changes over time

---

## MVP Phases

### Phase 1: Desk Prototype
- NFC tap to join/close round
- Score entry with par default
- Peer attestation
- Lab Mode for testing

### Phase 2: GPS + Maps
- Real-time distance to green
- Course detection
- Dynamic prompts based on location

### Phase 3: Games + Chips
- Side game creation
- Chip transactions
- Leaderboards
- Handicap calculation

---

## Key Metrics

| Metric | Target |
|--------|--------|
| Taps to start round | â‰¤ N-1 players |
| Time to close round | < 60 seconds |
| Games per round | 2-4 organic prompts |
| Attestation completion | > 95% of rounds |
| Disputes | < 5% of rounds |
