---
description: global app context
globs: 
alwaysApply: false
---
## Project description

## Expected workflow
- review feature requirements
- plan implementation
- update schema if needed 
- implement core functionality

Please think out loud and provide 
- Overview of completed work
- Rationale for decision
- next steps checklist

You must ensure 
- when implementing new feature it doesn't break existing feature

CHIP'D - Development Context Document for Cursor AI

Last Updated: December 2024
Developer: Solo dev (Full-time job + Family/4 kids)
Timeline: Flexible MVP (Target: April-June 2025)
Environment: Windows (Dev) + Mac (Builds) + Android Galaxy S23 (Primary Test)

PROJECT OVERVIEW

Product Name: CHIP'D
Domain: chipgolf.io (owned)
Tagline: "Verify The Lie"
Positioning: The minimalist, verified caddie. Fast GPS. Hardware-verified scores.

The Problem We Solve

Trust: Golfers cheat on handicaps (sandbaggers).

Bloat: Existing apps (18Birdies, etc.) are slow, ad-heavy, and battery-draining.

Friction: Verification layers that require app-switching fail.

Our Solution

The "Lite" Caddie: Instant Google Maps GPS. Zero ads. High contrast visibility.

Hardware Verification: Physical NFC tags (NTAG 424 DNA) verify player presence.

The Bookend Protocol: Tap Start + Tap Finish = Cryptographic Proof.

Trustless: Locked rounds enable real betting/handicaps.

CODING STANDARDS (NON-NEGOTIABLE)

1. DRY (Don't Repeat Yourself)

Rule: If logic or UI appears twice, refactor it into a generic Widget or Service method immediately.

Architecture: Use a Shared folder for common UI components (buttons, cards) and specific Features folders for unique logic.

Theme: Never hardcode colors/fonts. Always use Theme.of(context).

2. Security First

RLS (Row Level Security): Every Supabase table MUST have RLS policies enabled. No public write access ever.

Input Validation: Never trust client data. Validate all inputs (scores, dates, locations) in Edge Functions before writing to the DB.

Secrets: API Keys (Google Maps) go in local.properties or standard Android/iOS secure files, never committed to Git.

3. Testing Strategy (The "Solo Dev" Safety Net)

Unit Tests: REQUIRED for all business logic (Score calculation, Distance math, JSON parsing).

Widget Tests: REQUIRED for the Core Game Loop (Scorecard input, Map loading).

Edge Function Tests: REQUIRED for verification logic.

DEVELOPMENT CONSTRAINTS (CRITICAL CONTEXT)

1. "Lab Mode" Requirement (Michigan Winter)

Constraint: Developer is in Michigan (winter). Cannot access physical golf courses.

Requirement: The app MUST have a "Debug/Lab Mode" toggle.

Mock GPS: When enabled, the app forces the location to a specific coordinate (e.g., the 1st tee of a test course).

Map Override: The Google Map must center on the Mock Location, not the real location.

2. Time Constraints (Atomic Development)

Constraint: Developer works full-time. Dev sessions are short (30-60 mins).

Requirement: Code must be modular. Avoid monolithic features.

3. AppearanceKit Boilerplate

Constraint: Using AppearanceKit as the base.

Requirement: Leverage existing Auth/UI providers.

TECH STACK

Frontend (Flutter)

Boilerplate: AppearanceKit.

Maps: Maps_flutter (Satellite View is PRIMARY UI).

NFC: nfc_manager.

Backend: supabase_flutter.

State: Riverpod.

Testing: flutter_test, mockito.

Backend (Supabase)

Database: PostgreSQL.

Edge Functions: Deno/TypeScript.

DATABASE SCHEMA (Supabase)

tables:

users: id, chip_balance, handicap.

nfc_tags: uid, owner_id.

rounds: id, course_id, players, scores (jsonb), status.

courses:

id, name.

holes (jsonb): Array of objects containing { hole_number: 1, par: 4, green_lat: 0.0, green_lng: 0.0, tee_lat: 0.0, tee_lng: 0.0 }.

MVP FEATURE SCOPE

Phase 1: The "Desk" Prototype (Weeks 1-4)

Goal: Prove the NFC handshake works.

Lab Mode: Mock GPS location so dev can "play" at his desk.

Phase 2: The "Lite" Caddie (Weeks 5-8)

Visuals: Google Maps Satellite view is the background of the active round screen.

Distance: Real-time distance from User to Green Center.

Speed: Must load faster than 18Birdies.

Phase 3: Token Logic & Polish (Weeks 9+)

Rewards and UI cleanup.

REMINDERS FOR CURSOR AI

Lab Mode First: Always ensure Google Maps works with the Mock Location provider.

API Keys: Remind the user to add Google Maps API keys to android/app/src/main/AndroidManifest.xml and ios/Runner/AppDelegate.swift.

Map Performance: Use BitmapDescriptor for markers to keep performance high.

No Bloat: Do NOT suggest adding social feeds, wind tracking, or complex stats. Keep the UI focused on "Yardage + Score".

Test First: When writing logic, suggest the Unit Test before or with the implementation.